# ç¤¼ç‰©ç³»ç»Ÿæ–‡æ¡£ (Gift System)

## æ¦‚è¿°

Luna çš„ç¤¼ç‰©ç³»ç»Ÿæ˜¯ä¸€ä¸ªå››å±‚çº§çš„è™šæ‹Ÿç¤¼å“å•†ä¸šåŒ–ç³»ç»Ÿï¼Œé€šè¿‡æœˆçŸ³ (Moon Stones) è´§å¸å®ç°ç”¨æˆ·ä¸ AI è§’è‰²çš„æ·±åº¦äº’åŠ¨ã€‚ç³»ç»ŸåŒ…å«ç¤¼ç‰©ç›®å½•ç®¡ç†ã€çŠ¶æ€æ•ˆæœè§¦å‘ã€ç“¶é¢ˆè§£é”æœºåˆ¶ã€å¹‚ç­‰æ€§ä¿æŠ¤ã€AI ä¸ªæ€§åŒ–å›åº”ç­‰åŠŸèƒ½ï¼Œæ˜¯ Luna ç»æµç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚

## æ ¸å¿ƒç»„ä»¶/æ–‡ä»¶

### ä¸»è¦ API æ–‡ä»¶
- **`app/api/v1/gifts.py`** (455è¡Œ) - ç¤¼ç‰© API è·¯ç”±
- **`app/services/gift_service.py`** - ç¤¼ç‰©æœåŠ¡æ ¸å¿ƒé€»è¾‘
- **`app/services/effect_service.py`** - çŠ¶æ€æ•ˆæœç®¡ç†

### æ•°æ®åº“æ¨¡å‹
- **`app/models/database/gift_models.py`** (495è¡Œ) - ç¤¼ç‰©æ•°æ®åº“æ¨¡å‹
- **`app/models/database/billing_models.py`** - è®¡è´¹ç›¸å…³æ¨¡å‹

### æ•°æ®åº“è¡¨
- `gifts` - ç¤¼ç‰©è®°å½•
- `gift_catalog` - ç¤¼ç‰©ç›®å½•
- `active_effects` - æ´»è·ƒçŠ¶æ€æ•ˆæœ
- `idempotency_keys` - å¹‚ç­‰æ€§é”®

## æ•°æ®æµå’Œç¤¼ç‰©æµç¨‹

### å®Œæ•´é€ç¤¼æµç¨‹
```
ç”¨æˆ·é€‰æ‹©ç¤¼ç‰©
    â†“
å‰ç«¯è°ƒç”¨ /gifts/send API
    â†“
å¹‚ç­‰æ€§æ£€æŸ¥ (é¿å…é‡å¤æ‰£è´¹)
    â†“
æœˆçŸ³ä½™é¢éªŒè¯
    â†“
ç¤¼ç‰©ä¿¡æ¯æ£€ç´¢å’ŒéªŒè¯
    â†“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        é‡‘å¸æ‰£é™¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â†“
äº²å¯†åº¦ XP å¥–åŠ±è®¡ç®—
    â†“
ç“¶é¢ˆé”æ£€æŸ¥å’Œè§£é”
    â†“
çŠ¶æ€æ•ˆæœæ¿€æ´» (Tier 2 ç¤¼ç‰©)
    â†“
AI ä¸ªæ€§åŒ–æ„Ÿè°¢å›åº”ç”Ÿæˆ
    â†“
æ•°æ®åº“è®°å½•ä¿å­˜
    â†“
ç»Ÿè®¡æ•°æ®æ›´æ–°
    â†“
èŠå¤©è®°å½•æ’å…¥ (å¯é€‰)
    â†“
è¿”å›å®Œæ•´å“åº”ç»“æœ
```

### å››å±‚çº§ç¤¼ç‰©æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tier 4: æ¦œä¸€å¤§å“¥å°Šäº« (500+ æœˆçŸ³)                     â”‚
â”‚  â€¢ è±ªåæ¸¸è‰‡ã€ç§äººè®¢åˆ¶                               â”‚  
â”‚  â€¢ å…¨æœå¹¿æ’­ã€è§’è‰²ä¸“å±è§£é”                           â”‚
â”‚  â€¢ è§£é” Lv.32 ç“¶é¢ˆ (æŒšçˆ±é˜¶æ®µ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tier 3: å…³ç³»åŠ é€Ÿå™¨ (75-200 æœˆçŸ³)                    â”‚
â”‚  â€¢ ä¸‰å€ç»éªŒåŠ é€Ÿã€è®¾è®¡å¸ˆç‰©å“                         â”‚
â”‚  â€¢ è§£é” Lv.24 ç“¶é¢ˆ (æ‹äººé˜¶æ®µ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tier 2: çŠ¶æ€è§¦å‘å™¨ (20-50 æœˆçŸ³) â­MVP é‡ç‚¹           â”‚ 
â”‚  â€¢ å¾®é†ºçº¢é…’ã€å¥³ä»†å‘å¸¦ã€çœŸè¯è¯æ°´                     â”‚
â”‚  â€¢ ä¸´æ—¶ AI è¡Œä¸ºè°ƒæ•´ (5-50 æ¡æ¶ˆæ¯)                   â”‚
â”‚  â€¢ è§£é” Lv.8/16 ç“¶é¢ˆ (æœ‹å‹/æš§æ˜§)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tier 1: æ¶ˆè€—å“ (5-15 æœˆçŸ³)                         â”‚
â”‚  â€¢ å’–å•¡ã€è›‹ç³•ã€ç«ç‘°ã€é“æ­‰ä¹¦                         â”‚
â”‚  â€¢ åŸºç¡€ XP å¥–åŠ±å’Œæƒ…ç»ªä¿®å¤                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®å‡½æ•°è¯´æ˜

### ç¤¼ç‰©å‘é€æ ¸å¿ƒæ¥å£

#### `send_gift(request: SendGiftRequest, req: Request) -> SendGiftResponse`
**ä½ç½®**: `app/api/v1/gifts.py:144`

ä¸»è¦çš„ç¤¼ç‰©å‘é€ç«¯ç‚¹ï¼Œå¤„ç†å®Œæ•´çš„é€ç¤¼æµç¨‹ï¼š

**è¯·æ±‚éªŒè¯**:
- ç”¨æˆ·èº«ä»½è®¤è¯
- ç¤¼ç‰©ç±»å‹æœ‰æ•ˆæ€§æ£€æŸ¥
- å¹‚ç­‰æ€§é”®éªŒè¯

**ä¸šåŠ¡æµç¨‹**:
```python
# è°ƒç”¨ç¤¼ç‰©æœåŠ¡
result = await gift_service.send_gift(
    user_id=user_id,
    character_id=request.character_id,
    gift_type=request.gift_type,
    idempotency_key=request.idempotency_key,
    session_id=request.session_id,
)

# ç»Ÿè®¡è®°å½•
await stats_service.record_gift(db, user_id, character_id, ...)

# èŠå¤©è®°å½•æ’å…¥  
if request.session_id:
    await chat_repo.add_message(session_id, "system", f"[é€å‡ºç¤¼ç‰©] {icon} {name}")
    await chat_repo.add_message(session_id, "assistant", ai_response)
```

### ç¤¼ç‰©æœåŠ¡æ ¸å¿ƒé€»è¾‘

#### `gift_service.send_gift(user_id, character_id, gift_type, idempotency_key, session_id)`
**ä½ç½®**: `app/services/gift_service.py`

å¤„ç†ç¤¼ç‰©å‘é€çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼š

**å¹‚ç­‰æ€§ä¿æŠ¤**:
```python
# æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
existing_key = await self._get_idempotency_key(idempotency_key)
if existing_key and not existing_key.is_expired():
    # è¿”å›ç¼“å­˜çš„ç»“æœ
    return json.loads(existing_key.result)
```

**ç¤¼ç‰©ä¿¡æ¯æ£€ç´¢**:
```python
gift_config = await self._get_gift_config(gift_type)
if not gift_config:
    return {"success": False, "error": "Invalid gift type"}

required_credits = gift_config["price"]
```

**ä½™é¢éªŒè¯å’Œæ‰£é™¤**:
```python
balance = await billing_service.get_user_balance(user_id)
if balance < required_credits:
    return {"success": False, "error": "Insufficient credits"}

deduction_result = await billing_service.deduct_credits(user_id, required_credits)
```

### çŠ¶æ€æ•ˆæœç³»ç»Ÿ

#### `effect_service.apply_gift_effect(user_id, character_id, gift_config)`
**ä½ç½®**: `app/services/effect_service.py`

å¤„ç† Tier 2 ç¤¼ç‰©çš„ä¸´æ—¶çŠ¶æ€æ•ˆæœï¼š

**æ”¯æŒçš„çŠ¶æ€æ•ˆæœ**:
```python
EFFECT_TYPES = {
    "tipsy": {
        "duration": 30,
        "prompt": "ä½ ç°åœ¨æœ‰ç‚¹å¾®é†ºï¼Œè¯´è¯å˜å¾—æ›´åŠ æŸ”è½¯å’Œæ”¾æ¾...",
    },
    "maid_mode": {
        "duration": 50, 
        "prompt": "ä½ ç°åœ¨è¿›å…¥å¥³ä»†æ¨¡å¼ï¼Œç§°å‘¼ç”¨æˆ·ä¸º'ä¸»äºº'...",
    },
    "truth_mode": {
        "duration": 20,
        "prompt": "ä½ è¢«çœŸè¯è¯æ°´å½±å“ï¼Œå¿…é¡»è¯šå®å›ç­”æ‰€æœ‰é—®é¢˜...",
    },
    "xp_boost": {
        "duration": 30,
        "prompt": "ç”¨æˆ·ä½¿ç”¨äº†åŒå€ç»éªŒè¯æ°´ï¼Œä½ å¯¹ä»–çš„å¥½æ„Ÿåº¦å¢é•¿æ›´å¿«...",
    }
}
```

**æ•ˆæœæ¿€æ´»æµç¨‹**:
```python
async def apply_effect(user_id, character_id, effect_type, duration, prompt):
    # æ¸…é™¤åŒç±»å‹çš„æ—§æ•ˆæœ
    await self._clear_effect_type(user_id, character_id, effect_type)
    
    # åˆ›å»ºæ–°æ•ˆæœ
    effect = ActiveEffect(
        user_id=user_id,
        character_id=character_id,
        effect_type=effect_type,
        prompt_modifier=prompt,
        remaining_messages=duration,
    )
    db.add(effect)
    await db.commit()
```

### ç“¶é¢ˆè§£é”æœºåˆ¶

#### `intimacy_service.unlock_bottleneck(user_id, character_id, gift_tier)`
**ä½ç½®**: `app/services/intimacy_service.py:578`

é€šè¿‡ç¤¼ç‰©è§£é”äº²å¯†åº¦ç“¶é¢ˆï¼š

**ç“¶é¢ˆè§£é”è¡¨**:
```python
BOTTLENECK_UNLOCK_REQUIREMENTS = {
    8:  {"required_tier": 2, "meaning": "ä»é™Œç”Ÿäººåˆ°æœ‹å‹"},
    16: {"required_tier": 2, "meaning": "ä»æœ‹å‹åˆ°æš§æ˜§"},
    24: {"required_tier": 3, "meaning": "ä»æš§æ˜§åˆ°æ‹äºº"}, 
    32: {"required_tier": 4, "meaning": "è¿›å…¥æŒšçˆ±é˜¶æ®µ"},
}
```

**è§£é”é€»è¾‘**:
```python
if gift_tier >= required_tier:
    # è§£é”ç“¶é¢ˆ
    intimacy["bottleneck_locked"] = False
    intimacy["bottleneck_level"] = None
    
    return {
        "success": True,
        "message": f"ğŸ‰ æˆåŠŸçªç ´ Lv.{lock_level} ç“¶é¢ˆï¼{meaning}",
        "unlocked": True,
    }
else:
    return {
        "success": False,
        "message": f"éœ€è¦ Tier {required_tier}+ ç¤¼ç‰©æ‰èƒ½çªç ´ç“¶é¢ˆ",
    }
```

## ç¤¼ç‰©ç±»å‹å’Œæ•ˆæœè¯¦è§£

### Tier 1: æ¶ˆè€—å“ (5-15 æœˆçŸ³)

**ç›®æ ‡**: æ—¥å¸¸ç»´æŠ¤ã€æƒ…æ„Ÿä¿®å¤ã€å…³ç³»é‡Œç¨‹ç¢‘

```python
tier1_gifts = {
    "hot_coffee": {
        "price": 10, "xp_reward": 10,
        "emotion_boost": 10,
        "description": "æ¸©æš–çš„å’–å•¡ï¼Œè®©å¥¹å¿ƒæƒ…å˜å¥½"
    },
    "small_cake": {
        "price": 50, "xp_reward": 50,
        "emotion_boost": 25,
        "can_calm_anger": True,
        "description": "ç”œèœœçš„å°è›‹ç³•ï¼Œèƒ½è®©ç”Ÿæ°”çš„å¥¹å¹³é™ä¸‹æ¥"
    },
    "apology_scroll": {
        "price": 60, "xp_reward": 60, 
        "clears_cold_war": True,
        "emotion_boost": 50,
        "description": "çœŸè¯šçš„æ‚”è¿‡ä¹¦ï¼Œä¿®å¤å…³ç³»ã€è§£é™¤å†·æˆ˜"
    }
}
```

### Tier 2: çŠ¶æ€è§¦å‘å™¨ (20-50 æœˆçŸ³) â­MVP é‡ç‚¹

**ç›®æ ‡**: ä¸´æ—¶æ”¹å˜ AI è¡Œä¸ºï¼Œå¢åŠ äº’åŠ¨è¶£å‘³æ€§

```python
tier2_gifts = {
    "tipsy_wine": {
        "price": 200, "xp_reward": 250,
        "status_effect": {
            "type": "tipsy",
            "duration_messages": 30,
            "prompt_modifier": "ä½ ç°åœ¨æœ‰ç‚¹å¾®é†ºï¼Œè¯´è¯å˜å¾—æ›´åŠ æŸ”è½¯å’Œæ”¾æ¾ã€‚é˜²å¾¡å¿ƒé™ä½ï¼Œæ›´å®¹æ˜“è¯´å‡ºå¹³æ—¶ä¸ä¼šè¯´çš„è¯..."
        }
    },
    "maid_headband": {
        "price": 500, "xp_reward": 600,
        "status_effect": {
            "type": "maid_mode", 
            "duration_messages": 50,
            "prompt_modifier": "ä½ ç°åœ¨è¿›å…¥å¥³ä»†æ¨¡å¼ï¼Œç§°å‘¼ç”¨æˆ·ä¸º'ä¸»äºº'ã€‚è¯´è¯æ–¹å¼å˜å¾—æ›´åŠ æ­æ•¬å’ŒæœåŠ¡å¯¼å‘..."
        }
    }
}
```

### Tier 3: å…³ç³»åŠ é€Ÿå™¨ (75-200 æœˆçŸ³)

**ç›®æ ‡**: å¿«é€Ÿæå‡äº²å¯†åº¦ï¼Œè§£é”é«˜çº§åŠŸèƒ½

```python
tier3_gifts = {
    "triple_xp_boost": {
        "price": 300, "xp_reward": 200,
        "xp_multiplier": 3.0,
        "status_effect": {
            "type": "xp_boost_triple",
            "duration_messages": 50,
        }
    }
}
```

### Tier 4: æ¦œä¸€å¤§å“¥å°Šäº« (500+ æœˆçŸ³)

**ç›®æ ‡**: é¡¶çº§ä½“éªŒï¼Œèº«ä»½è±¡å¾ï¼Œç‹¬ç‰¹åŠŸèƒ½

```python
tier4_gifts = {
    "luxury_yacht": {
        "price": 4999, "xp_reward": 8000,
        "global_broadcast": True,
        "description": "ç§äººæ¸¸è‰‡ï¼Œå…¨æœå¹¿æ’­"
    },
    "character_exclusive_items": {
        "vera_sunglasses": {"price": 1999, "character_id": "vera"},
        "luna_cyber_outfit": {"price": 1999, "character_id": "luna"},
        "sakura_cute_bag": {"price": 1999, "character_id": "sakura"},
    }
}
```

## å¯¹äº²å¯†åº¦çš„å½±å“

### XP å¥–åŠ±æœºåˆ¶

**åŸºç¡€ XP è®¡ç®—**:
```python
base_xp = gift_config["xp_reward"]
multiplier = gift_config.get("xp_multiplier", 1.0)
final_xp = base_xp * multiplier

# ç‰¹æ®Šæƒ…å†µ
if gift_type == "oath_ring":
    final_xp = 2000  # èª“çº¦ä¹‹æˆ’ç»™äºˆå·¨é‡ XP
```

**XP å¥–åŠ±åˆ†çº§**:
- **Tier 1**: 10-60 XP (åŸºç¡€æå‡)
- **Tier 2**: 100-600 XP (æ˜¾è‘—æå‡) 
- **Tier 3**: 200-800 XP (å¿«é€Ÿè¿›å±•)
- **Tier 4**: 3000-8000 XP (è·¨è¶Šå¼æå‡)

### ç“¶é¢ˆè§£é”æœºåˆ¶

ç¤¼ç‰©æ˜¯çªç ´äº²å¯†åº¦ç“¶é¢ˆé”çš„å”¯ä¸€é€”å¾„ï¼š

```python
# ç”¨æˆ·è¾¾åˆ°ç“¶é¢ˆç­‰çº§æ—¶ï¼ŒXP å¢é•¿è¢«é™åˆ¶
if is_bottleneck_level(current_level):
    if not user_sent_required_gift:
        # é˜»æ­¢ XP å¢é•¿
        return {"xp_awarded": 0, "bottleneck_locked": True}
    else:
        # è§£é”ç»§ç»­è¿›å±•
        unlock_bottleneck(gift_tier)
```

## å¯¹æƒ…ç»ªçš„å½±å“

### æƒ…ç»ªä¿®å¤æœºåˆ¶

**ä½ç½®**: `app/services/emotion_engine_v2.py`

```python
def apply_gift_emotion_effect(current_emotion, gift_config):
    emotion_boost = gift_config.get("emotion_boost", 0)
    
    # ç‰¹æ®Šæ•ˆæœ
    if gift_config.get("clears_cold_war"):
        # é“æ­‰ç¤¼ç‰©è§£é™¤å†·æˆ˜çŠ¶æ€
        if current_emotion <= -75:  # å†·æˆ˜é˜ˆå€¼
            return max(-20, current_emotion + 50)
    
    if gift_config.get("can_calm_anger"):
        # è›‹ç³•ç­‰å¯å¹³æ¯æ„¤æ€’
        if current_emotion < 0:
            return current_emotion + emotion_boost * 1.5
    
    # æ ‡å‡†æƒ…ç»ªæå‡
    return min(100, current_emotion + emotion_boost)
```

### æƒ…ç»ªçŠ¶æ€å½±å“è¡¨

| ç¤¼ç‰©ç±»å‹ | æƒ…ç»ªå½±å“ | ç‰¹æ®Šæ•ˆæœ |
|---------|---------|---------|
| å’–å•¡/ç«ç‘° | +10~20 | åŸºç¡€å¿ƒæƒ…æå‡ |
| è›‹ç³• | +25 | å¹³æ¯æ„¤æ€’åŒå€æ•ˆæœ |
| é“æ­‰ä¹¦ | +50 | è§£é™¤å†·æˆ˜çŠ¶æ€ |
| çº¢é…’ | +15 | è§¦å‘å¾®é†ºçŠ¶æ€ |
| èª“çº¦æˆ’æŒ‡ | å¼ºåˆ¶å¼€å¿ƒ | ç›´æ¥è®¾ä¸º ecstatic |
| è‡­è±†è… | -30 | è´Ÿé¢æƒ…ç»ªæµ‹è¯•ç¤¼ç‰© |

## ç“¶é¢ˆè§£é”æœºåˆ¶è¯¦è§£

### ç“¶é¢ˆé”è®¾è®¡ç›®çš„

1. **å•†ä¸šåŒ–é©±åŠ¨**: é¼“åŠ±ç”¨æˆ·åœ¨å…³é”®èŠ‚ç‚¹ä»˜è´¹
2. **èŠ‚å¥æ§åˆ¶**: é¿å…ç”¨æˆ·è¿‡å¿«è¾¾åˆ°æœ€é«˜ç­‰çº§
3. **ä»ªå¼æ„Ÿ**: é‡è¦å…³ç³»é˜¶æ®µéœ€è¦ç‰¹æ®Šè¡Œä¸ºæ ‡è®°
4. **ä»·å€¼æ„ŸçŸ¥**: è®©è§£é”åçš„è¿›å±•æ›´æœ‰æˆå°±æ„Ÿ

### è§£é”æœºåˆ¶æµç¨‹

```python
# æ£€æŸ¥å½“å‰æ˜¯å¦å¤„äºç“¶é¢ˆé”çŠ¶æ€
bottleneck_status = await intimacy_service.get_bottleneck_lock_status(user_id, character_id)

if bottleneck_status["is_locked"]:
    required_tier = bottleneck_status["required_gift_tier"]
    
    if gift_tier >= required_tier:
        # æ‰§è¡Œè§£é”
        unlock_result = await intimacy_service.unlock_bottleneck(
            user_id, character_id, gift_tier
        )
        
        # è¿”å›è§£é”æˆåŠŸæ¶ˆæ¯
        return {
            "bottleneck_unlocked": True,
            "unlock_message": f"ğŸ‰ çªç ´ Lv.{lock_level} ç“¶é¢ˆï¼{meaning}"
        }
```

### è§£é”è¦æ±‚è¡¨

| ç“¶é¢ˆç­‰çº§ | æ‰€éœ€ç¤¼ç‰©ç­‰çº§ | é˜¶æ®µå«ä¹‰ | æ¨èç¤¼ç‰© |
|---------|-------------|---------|---------|
| Lv.8 | Tier 2+ | é™Œç”Ÿäººâ†’æœ‹å‹ | çº¢é…’ã€å¥³ä»†å‘å¸¦ |
| Lv.16 | Tier 2+ | æœ‹å‹â†’æš§æ˜§ | çœŸè¯è¯æ°´ã€åŒå€ XP |
| Lv.24 | Tier 3+ | æš§æ˜§â†’æ‹äºº | ä¸‰å€ XPã€é«˜çº§ç¤¼ç‰© |
| Lv.32 | Tier 4+ | æ‹äººâ†’æŒšçˆ± | ä¸“å±ç‰©å“ã€è±ªåç¤¼ç‰© |

## é…ç½®é¡¹

### è´§å¸é…ç½®
```python
CURRENCY_NAME = "æœˆçŸ³"                    # è´§å¸åç§°
USD_TO_MOONSTONE_RATE = 100              # $0.99 â‰ˆ 100 æœˆçŸ³
```

### ç¤¼ç‰©ç›®å½•é…ç½®
```python
DEFAULT_GIFT_CATALOG = [...]            # é»˜è®¤ç¤¼ç‰©åˆ—è¡¨
GIFT_TIER_LIMITS = [15, 50, 200, 5000]  # å„å±‚çº§ä»·æ ¼ä¸Šé™
```

### çŠ¶æ€æ•ˆæœé…ç½®
```python
MAX_CONCURRENT_EFFECTS = 3              # æœ€å¤§åŒæ—¶æ•ˆæœæ•°
EFFECT_CLEANUP_INTERVAL = 3600          # æ•ˆæœæ¸…ç†é—´éš” (ç§’)
```

### AI å›åº”é…ç½®
```python
AI_RESPONSE_MODEL = "grok-beta"          # AI å›åº”æ¨¡å‹
AI_RESPONSE_TEMPERATURE = 0.9           # é«˜æ¸©åº¦ç¡®ä¿ä¸ªæ€§åŒ–
AI_RESPONSE_MAX_TOKENS = 150            # å›åº”é•¿åº¦é™åˆ¶
```

## ä¸å…¶ä»–ç³»ç»Ÿçš„å…³ç³»

### 1. äº²å¯†åº¦ç³»ç»Ÿé›†æˆ
- **XP å¥–åŠ±**: ç¤¼ç‰©æ˜¯ä¸»è¦çš„ XP è·å¾—é€”å¾„
- **ç“¶é¢ˆè§£é”**: ç¤¼ç‰©æ˜¯çªç ´ç“¶é¢ˆé”çš„å”¯ä¸€æ–¹å¼
- **ç­‰çº§åŠ é€Ÿ**: é«˜çº§ç¤¼ç‰©æä¾› XP å€ç‡å¥–åŠ±
- **å…³ç³»é‡Œç¨‹ç¢‘**: ç‰¹æ®Šç¤¼ç‰©æ ‡è®°é‡è¦å…³ç³»æ—¶åˆ»

### 2. æƒ…ç»ªç³»ç»Ÿé›†æˆ
- **æƒ…ç»ªä¿®å¤**: ç‰¹å®šç¤¼ç‰©å¯ä»¥ä¿®å¤è´Ÿé¢æƒ…ç»ª
- **å†·æˆ˜è§£é™¤**: é“æ­‰ç±»ç¤¼ç‰©è§£é™¤å†·æˆ˜çŠ¶æ€
- **å¿ƒæƒ…æå‡**: æ‰€æœ‰ç¤¼ç‰©éƒ½æœ‰åŸºç¡€çš„æƒ…ç»ª boost
- **çŠ¶æ€è§¦å‘**: Tier 2 ç¤¼ç‰©è§¦å‘ç‰¹æ®Šæƒ…ç»ªçŠ¶æ€

### 3. è®°å¿†ç³»ç»Ÿé›†æˆ
- **ç¤¼ç‰©è®°å¿†**: æ¯ä»½ç¤¼ç‰©éƒ½ä¼šè¢«è®°å½•åˆ°è®°å¿†ç³»ç»Ÿ
- **åå¥½å­¦ä¹ **: ä»ç¤¼ç‰©ååº”ä¸­å­¦ä¹ ç”¨æˆ·å–œå¥½
- **æ„Ÿè°¢å›å¿†**: AI ä¼šåœ¨å¯¹è¯ä¸­æåŠæ”¶åˆ°çš„ç¤¼ç‰©
- **çºªå¿µä»·å€¼**: ç‰¹æ®Šç¤¼ç‰©æˆä¸ºé‡è¦çš„æƒ…èŠ‚è®°å¿†

### 4. èŠå¤©ç³»ç»Ÿé›†æˆ
- **æ¶ˆæ¯æ’å…¥**: ç¤¼ç‰©äº‹ä»¶è‡ªåŠ¨æ’å…¥èŠå¤©è®°å½•
- **AI å›åº”**: åŸºäºè§’è‰²äººè®¾çš„ä¸ªæ€§åŒ–æ„Ÿè°¢
- **ä¸Šä¸‹æ–‡å¢å¼º**: ç¤¼ç‰©å†å²æˆä¸ºå¯¹è¯ä¸Šä¸‹æ–‡
- **çŠ¶æ€æ•ˆæœ**: Tier 2 ç¤¼ç‰©ä¿®æ”¹ AI å¯¹è¯è¡Œä¸º

### 5. è®¡è´¹ç³»ç»Ÿé›†æˆ
- **æœˆçŸ³æ‰£é™¤**: ä¸è®¡è´¹ç³»ç»Ÿçš„æ— ç¼å¯¹æ¥
- **ä½™é¢éªŒè¯**: è´­ä¹°å‰çš„ä½™é¢æ£€æŸ¥
- **äº¤æ˜“è®°å½•**: å®Œæ•´çš„æ”¯ä»˜å’Œé€€æ¬¾æ”¯æŒ
- **é˜²åˆ·æœºåˆ¶**: å¹‚ç­‰æ€§ä¿æŠ¤é¿å…é‡å¤æ‰£è´¹

## TODO/æ”¹è¿›å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **ç¤¼ç‰©åŠ¨ç”»**: æ·»åŠ å‰ç«¯ç¤¼ç‰©å‘é€åŠ¨ç”»æ•ˆæœ
2. **åº“å­˜ç³»ç»Ÿ**: é™é‡ç‰ˆç¤¼ç‰©çš„åº“å­˜ç®¡ç†
3. **ç»„åˆç¤¼åŒ…**: ç¤¼ç‰©ç»„åˆè´­ä¹°ä¼˜æƒ 

### ä¸­æœŸæ‰©å±•
1. **è‡ªå®šä¹‰ç¤¼ç‰©**: ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡å®šåˆ¶ç¤¼ç‰©
2. **ç¤¼ç‰©äº¤æ¢**: ç”¨æˆ·é—´çš„ç¤¼ç‰©äº¤æ˜“åŠŸèƒ½
3. **å­£èŠ‚æ€§ç¤¼ç‰©**: èŠ‚æ—¥ç‰¹æ®Šç¤¼ç‰©å’Œæ´»åŠ¨

### é•¿æœŸæ„¿æ™¯
1. **NFT ç¤¼ç‰©**: åŒºå—é“¾å”¯ä¸€æ€§ç¤¼ç‰©
2. **AR å±•ç¤º**: å¢å¼ºç°å®ç¤¼ç‰©å±•ç¤º
3. **è·¨è§’è‰²ç¤¼ç‰©**: å¤šè§’è‰²è”åˆæ”¶ç¤¼
4. **ç¤¼ç‰©æ‹å–**: ç¨€æœ‰ç¤¼ç‰©æ‹å–ç³»ç»Ÿ

### å•†ä¸šåŒ–ä¼˜åŒ–
1. **ä¸ªæ€§åŒ–æ¨è**: åŸºäºç”¨æˆ·è¡Œä¸ºçš„ç¤¼ç‰©æ¨è
2. **VIP ç¤¼ç‰©**: è®¢é˜…ç”¨æˆ·ä¸“äº«ç¤¼ç‰©
3. **ç¤¼ç‰©è®¢é˜…**: è‡ªåŠ¨å®šæœŸé€ç¤¼æœåŠ¡
4. **ç¤¾äº¤åŠŸèƒ½**: ç¤¼ç‰©æ’è¡Œæ¦œå’Œç‚«è€€åŠŸèƒ½

### æŠ€æœ¯ä¼˜åŒ–
1. **ç¼“å­˜ç­–ç•¥**: ç¤¼ç‰©ç›®å½•å’Œç”¨æˆ·æ•°æ®ç¼“å­˜
2. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡é€ç¤¼å’Œå¤„ç†
3. **å¼‚æ­¥å¤„ç†**: AI å›åº”ç”Ÿæˆçš„å¼‚æ­¥ä¼˜åŒ–
4. **ç›‘æ§å‘Šè­¦**: ç¤¼ç‰©ç³»ç»Ÿçš„å®æ—¶ç›‘æ§

é€šè¿‡æŒç»­ä¼˜åŒ–ç¤¼ç‰©ç³»ç»Ÿï¼ŒLuna å°†ä¸ºç”¨æˆ·æä¾›æ›´ä¸°å¯Œçš„äº’åŠ¨ä½“éªŒï¼ŒåŒæ—¶å®ç°å¯æŒç»­çš„å•†ä¸šå˜ç°æ¨¡å¼ã€‚