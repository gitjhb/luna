# Luna çº¦ä¼šç³»ç»Ÿ E2E æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2026-02-25 23:40 PST  
**æµ‹è¯•äººå‘˜**: Nikki (AI Assistant)  
**æµ‹è¯•ç¯å¢ƒ**: localhost:8001 (Luna Backend)

---

## æµ‹è¯•æ¦‚è¦

| é¡¹ç›® | ç»“æœ |
|------|------|
| æµ‹è¯•åœºæ™¯ | äº’åŠ¨å¼çº¦ä¼šæµç¨‹ |
| æµ‹è¯•ç”¨æˆ· | fb-hdND1zeZOkdP74SdypFmmuF0SA03 |
| æµ‹è¯•è§’è‰² | Luna (d2b3c4d5-e6f7-4a8b-9c0d-1e2f3a4b5c6d) |
| æ€»ä½“ç»“æœ | âœ… é€šè¿‡ |

---

## æµ‹è¯•æµç¨‹

### 1. å‰ç½®æ¡ä»¶æ£€æŸ¥ âœ…
- ç”¨æˆ·ç­‰çº§: LV 14 (éœ€è¦ LV 10+)
- é¦–æ¬¡ç¤¼ç‰©: å·²å®Œæˆ
- å†·å´çŠ¶æ€: æ— å†·å´
- è¿›è¡Œä¸­çº¦ä¼š: æ— 

### 2. è·å–åœºæ™¯åˆ—è¡¨ âœ…
```
GET /api/v1/dates/scenarios?character_id={char_id}
```
- è¿”å› 31 ä¸ªåœºæ™¯
- åŒ…å«è§£é”/é”å®šçŠ¶æ€
- ä¸“å±åœºæ™¯æ­£ç¡®æ ‡è®°

### 3. å¼€å§‹çº¦ä¼š âœ…
```
POST /api/v1/dates/interactive/start
Body: {character_id, scenario_id: "bookstore_browse"}
```
- åˆ›å»ºä¼šè¯: 54d8943f-4693-49e1-bb83-5f37f6d43dd4
- è¿”å›ç¬¬ä¸€é˜¶æ®µå‰§æƒ…å’Œ3ä¸ªé€‰é¡¹
- æ”¯æŒè‡ªç”±è¾“å…¥: true

### 4. åšå‡ºé€‰æ‹© (5ä¸ªé˜¶æ®µ) âœ…
```
POST /api/v1/dates/interactive/choose
Body: {session_id, choice_id}
```

| é˜¶æ®µ | é€‰æ‹© | å¥½æ„Ÿå˜åŒ– | è¡¨æƒ… |
|-----|------|---------|------|
| 1â†’2 | æ¸©æŸ”é è¿‘ | +10 | happy |
| 2â†’3 | åˆ†äº«è¯—å¥ | +12 | happy |
| 3â†’4 | ç»§ç»­äº’åŠ¨ | +12 | happy |
| 4â†’5 | ç»™å¥¹å……ç”µ | +12 | happy |
| 5â†’ç»“å±€ | æµªæ¼«å‘Šç™½ | +15 | - |

### 5. å®Œæˆçº¦ä¼š âœ…
```
POST /api/v1/dates/interactive/finish
Body: {session_id}
```

**æœ€ç»ˆç»“æœ:**
- çŠ¶æ€: completed
- å¥½æ„Ÿæ€»åˆ†: 61
- ç»“å±€ç±»å‹: **perfect** ğŸŒŸ
- è·å¾—XP: 100
- å†·å´æ—¶é—´: 24å°æ—¶

### 6. ç”¨æˆ·æ•°æ®éªŒè¯ âœ…
- ç­‰çº§å˜åŒ–: 14 â†’ 15
- XPå˜åŒ–: 3083 â†’ 3183 (+100)
- äº²å¯†é˜¶æ®µ: ambiguous (æš§æ˜§æœŸ)

---

## API ç«¯ç‚¹è¦†ç›–

| ç«¯ç‚¹ | æ–¹æ³• | çŠ¶æ€ |
|------|------|------|
| /dates/unlock-status/{char_id} | GET | âœ… |
| /dates/status/{char_id} | GET | âœ… |
| /dates/scenarios | GET | âœ… |
| /dates/interactive/start | POST | âœ… |
| /dates/interactive/choose | POST | âœ… |
| /dates/interactive/session/{id} | GET | âœ… |
| /dates/interactive/finish | POST | âœ… |
| /dates/interactive/abandon | POST | âœ… |
| /dates/interactive/extend | POST | â³ æœªæµ‹è¯• |
| /dates/interactive/reset-cooldown | POST | â³ æœªæµ‹è¯• |
| /dates/interactive/free-input | POST | â³ æœªæµ‹è¯• |

---

## å·²çŸ¥é—®é¢˜

1. **JSON æ§åˆ¶å­—ç¬¦**: API å“åº”åŒ…å«æ§åˆ¶å­—ç¬¦ (U+0000-U+001F)ï¼Œéœ€è¦æ¸…ç†åæ‰èƒ½è§£æ
2. **å¥½æ„Ÿç´¯è®¡æ˜¾ç¤º**: `total_affection` åœ¨é€‰æ‹©å“åº”ä¸­å§‹ç»ˆä¸º 0ï¼Œä½†å®é™…ç´¯è®¡æ­£ç¡®

---

## æµ‹è¯•ç»“è®º

**çº¦ä¼šç³»ç»Ÿæ ¸å¿ƒæµç¨‹æ­£å¸¸è¿ä½œ**ï¼Œå¯ä»¥ï¼š
- æ­£ç¡®æ£€æŸ¥è§£é”æ¡ä»¶
- ç”Ÿæˆäº’åŠ¨å¼å‰§æƒ…
- å¤„ç†ç”¨æˆ·é€‰æ‹©
- è®¡ç®—å¥½æ„Ÿåº¦
- å‘æ”¾XPå¥–åŠ±
- è®¾ç½®å†·å´æ—¶é—´

**å»ºè®®**:
- ä¿®å¤ JSON å“åº”ä¸­çš„æ§åˆ¶å­—ç¬¦é—®é¢˜
- ä¼˜åŒ– `total_affection` è¿”å›å€¼æ˜¾ç¤º
