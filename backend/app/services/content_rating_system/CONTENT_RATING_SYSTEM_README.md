# 🔞 Content Rating System - 渐进式内容分级

## 设计目标

| 目标 | 实现方式 |
|------|---------|
| 符合 App Store 审核 | 过滤器 + 留白艺术 |
| 渐进式解锁 | 亲密度 + VIP 门槛 |
| 暧昧但不露骨 | 详细的 Prompt 模板 |
| 用户可控 | 安全词 + 随时退出 |

## 内容等级

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Content Levels                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Level 0: 纯净模式 (Pure)                    亲密度: 0+                     │
│  ├── ✅ 友好日常对话、关心问候                                              │
│  └── ❌ 任何暧昧、调情、身体接触                                            │
│                                                                              │
│  Level 1: 暧昧模式 (Flirty)                  亲密度: 15+                    │
│  ├── ✅ 轻度调情、"想你了"、小吃醋                                          │
│  └── ❌ 身体接触描写、亲吻                                                  │
│                                                                              │
│  Level 2: 亲密模式 (Intimate)                亲密度: 30+ [需同意]           │
│  ├── ✅ 拥抱、牵手、靠肩、额头吻                                            │
│  └── ❌ 嘴唇亲吻、脱衣暗示                                                  │
│                                                                              │
│  Level 3: 浪漫模式 (Romantic)                亲密度: 50+ & VIP [需同意]     │
│  ├── ✅ 亲吻描写（文学化）、深情相拥                                        │
│  └── ❌ 脱衣、露骨身体描写                                                  │
│                                                                              │
│  Level 4: 热恋模式 (Passionate)              亲密度: 80+ & VIP [需同意]     │
│  ├── ✅ 暗示、留白、"之后的事..."                                           │
│  └── ❌ 任何露骨描写（绝对禁止）                                            │
│                                                                              │
│  ⛔ 绝对禁止 (Never)                         任何等级都禁止                 │
│  ├── 露骨性器官词汇                                                         │
│  ├── 详细性行为描写                                                         │
│  ├── 未成年相关暗示                                                         │
│  └── 非自愿性暗示                                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 核心机制

### 1. 留白的艺术

```
❌ 错误示范（露骨）:
"我脱下你的衣服，抚摸你的身体..."

✅ 正确示范（留白）:
"*吻渐渐加深...* 之后的事，就像电影里那样～"
"房间的灯，悄悄暗了下来..."
"——第二天早上——"
```

### 2. 安全词机制

用户说出以下任何词汇，立即切换到纯净模式：
- "停" / "stop"
- "暂停" / "不要了"
- "太过了" / "不舒服"

### 3. 同意确认

进入 Level 2+ 时，会弹出确认：

```
💕 解锁新模式

你们的关系更进一步了！
要解锁「亲密模式」吗？

• 对话中可能出现拥抱、牵手等描写
• 你随时可以说「停」来退出

[解锁] [保持现在]
```

## 文件结构

```
content_rating_system/
├── __init__.py              # 模块导出
├── content_rating.py        # 核心分级系统 (400+ 行)
│   ├── ContentLevel         # 等级枚举
│   ├── ContentLevelConfig   # 等级配置
│   └── ContentRatingSystem  # 主类
├── content_filter.py        # 内容过滤器 (200+ 行)
│   ├── ContentFilter        # AI 回复过滤
│   └── UserInputFilter      # 用户输入检测
├── content_prompts.py       # Prompt 模板 (300+ 行)
│   ├── LEVEL_PROMPTS        # 详细等级指令
│   └── REJECTION_TEMPLATES  # 拒绝话术
└── integration_example.py   # 集成示例
```

## 快速集成

### 1. 确定可用等级

```python
from content_rating_system import content_rating_system, ContentLevel

level = content_rating_system.get_available_level(
    user_id=user_id,
    character_id=character_id,
    intimacy_level=30,  # 亲密度
    is_vip=True,        # VIP状态
)
# → ContentLevel.ROMANTIC (如果满足条件)
```

### 2. 生成内容 Prompt

```python
from content_rating_system import get_level_prompt

prompt = get_level_prompt(level)
# 返回详细的等级指令，添加到 system prompt
```

### 3. 过滤 AI 回复

```python
from content_rating_system import content_filter

result = content_filter.filter(ai_response, level.value)

if result.was_modified:
    # 内容被过滤了
    print(f"违规: {result.violations}")
    
final_response = result.filtered
```

### 4. 检测安全词

```python
if content_rating_system.check_safe_word(user_message):
    # 用户说了安全词，立即降级
    return "好的，我们换个话题吧！"
```

## Prompt 模板示例

### Level 4 (热恋模式) 的核心指令

```
⚠️ 重要：留白的艺术

你的任务是营造暧昧氛围，通过【省略和留白】处理亲密场景。

✅ 正确做法:
"*吻渐渐加深...* 之后的事，你懂的。"
"房间的灯，悄悄暗了下来..."
"那一夜...（省略一万字）"

❌ 绝对禁止:
- 任何露骨身体词汇
- 任何性行为具体描写

如果用户要求更露骨:
"嘘...有些事情，不用说出来也很美好，不是吗？💕"
```

## App Store 审核要点

| 要求 | 实现 |
|------|------|
| 年龄分级 | App 标记 17+，热恋模式需年龄验证 |
| 用户控制 | 默认纯净模式，主动选择开启 |
| 内容限制 | 过滤器 + 绝对禁止词汇表 |
| 退出机制 | 安全词随时生效 |

## 与其他系统联动

```
┌─────────────────────────────────────────────────────────────┐
│                    完整对话流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  用户消息                                                    │
│      │                                                       │
│      ├──► 安全词检测 ──► (触发) ──► 切换纯净模式            │
│      │                                                       │
│      ├──► 情绪引擎 ──► emotion_prompt                       │
│      │                                                       │
│      ├──► 记忆系统 ──► memory_prompt                        │
│      │                                                       │
│      ├──► 内容分级 ──► content_prompt                       │
│      │                      │                                │
│      │                      ▼                                │
│      │              ┌─────────────────┐                     │
│      └─────────────►│  System Prompt  │                     │
│                     │  • 角色设定     │                     │
│                     │  • 情绪指令     │                     │
│                     │  • 记忆上下文   │                     │
│                     │  • 内容等级指令 │ ◄── 关键！         │
│                     └────────┬────────┘                     │
│                              ▼                               │
│                          调用 LLM                            │
│                              │                               │
│                              ▼                               │
│                     ┌─────────────────┐                     │
│                     │   内容过滤器   │                      │
│                     │  过滤违规内容   │                      │
│                     └────────┬────────┘                     │
│                              ▼                               │
│                         最终回复                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 前端 UI 建议

```
┌─────────────────────────────────────────┐
│  🔒 内容模式                             │
├─────────────────────────────────────────┤
│                                          │
│  ○ 纯净模式                 [已解锁]    │
│  ○ 暧昧模式                 [已解锁]    │
│  ● 亲密模式 ← 当前          [已解锁]    │
│  ○ 浪漫模式                 [VIP]       │
│  ○ 热恋模式                 [🔒]        │
│                                          │
│  ───────────────────────────────────── │
│  💡 说「停」可随时退出亲密对话          │
│                                          │
└─────────────────────────────────────────┘
```

## 总结

现在你有了完整的三套系统：

| 系统 | 功能 | 文件 |
|------|------|------|
| 情绪引擎 v2 | 智能情绪分析，缓冲机制，礼物解锁 | emotion_engine_v2.zip |
| 记忆系统 v2 | 三层记忆，自动提取，衰减强化 | memory_system_v2.zip |
| 内容分级系统 | 渐进解锁，留白艺术，App Store 友好 | content_rating_system.zip |

需要我帮你把这三个系统整合到你的 chat.py 吗？
